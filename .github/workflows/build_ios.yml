name: Build iOS IPA

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write
  actions: read
  checks: write

jobs:
  build_ios:
    runs-on: macos-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.24.5'
        channel: 'stable'
        
    - name: Install dependencies
      run: flutter pub get
      
    - name: Clean build
      run: flutter clean
      
    - name: Get dependencies again
      run: flutter pub get
      
    - name: Build iOS (without signing)
      run: |
        flutter build ios --release --no-codesign
        
    - name: Create Payload directory
      run: |
        mkdir -p Payload
        
    - name: Copy app to Payload
      run: |
        cp -r build/ios/iphoneos/Runner.app Payload/
        
    - name: Create IPA file
      run: |
        zip -r SR3H_Video_Converter_v2.0.9.ipa Payload/
        
    - name: Upload IPA artifact
      uses: actions/upload-artifact@v4
      with:
        name: SR3H_Video_Converter_IPA
        path: SR3H_Video_Converter_v2.0.9.ipa
        retention-days: 30
        
    - name: Create Release
      if: github.ref == 'refs/heads/main' && github.event_name == 'push'
      uses: softprops/action-gh-release@v2
      with:
        tag_name: v2.0.9-${{ github.run_number }}
        name: "Ù…Ø­ÙˆÙ‘Ù„ Ø³Ø±Ø¹Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.0.9"
        body: |
          ## ğŸ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.0.9
          
          ### ğŸ”§ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
          - ğŸ”„ **Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ RTL**: Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
          - ğŸ¨ **Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…ÙˆØ­Ø¯Ø©**: Ø§Ø³ØªØ®Ø¯Ø§Ù… 800x800.png ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹
          - âœï¸ **Ø®Ø· Tajawal**: ØªØ·Ø¨ÙŠÙ‚ Ø®Ø· Tajawal Ø§Ù„Ù…Ø­Ø³Ù†
          - ğŸ” **Hardware ID Ø«Ø§Ø¨Øª**: Ù†Ø¸Ø§Ù… Keychain - Ø«Ø§Ø¨Øª 100% Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          
          ### âœ… Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:
          - ğŸ¨ ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ ØªØµÙ…ÙŠÙ… Ø£Ù†ÙŠÙ‚
          - â° Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© ÙÙ‚Ø·
          - ğŸ“ Ø²Ø± "Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª" Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
          - âœ… ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø£Ø®Ø¶Ø± Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù
          - ğŸ“± Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø£Ù„Ø¨ÙˆÙ… SR3H Ø¨Ø§Ù„Ù…Ø¹Ø±Ø¶
          - ğŸ“Š Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„
          - ğŸ’¡ Ù†ØµØ§Ø¦Ø­ TikTok Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…
          
          ### ğŸ› ï¸ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©:
          - ØªØ­Ø³ÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙØ¹ÙŠÙ„
          - ØªØ­Ø³ÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© "Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
          - Ø¥ØµÙ„Ø§Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
          - ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          
          ### ğŸ“± Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„:
          - iOS 12.0 Ø£Ùˆ Ø£Ø­Ø¯Ø«
          - Ù…Ø³Ø§Ø­Ø© ØªØ®Ø²ÙŠÙ† ÙƒØ§ÙÙŠØ© Ù„Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
          - Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ù„ØªÙØ¹ÙŠÙ„
          
          ### ğŸ“¥ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ«Ø¨ÙŠØª:
          1. Ø­Ù…Ù„ Ù…Ù„Ù IPA Ø§Ù„Ù…Ø±ÙÙ‚
          2. Ø§Ø³ØªØ®Ø¯Ù… AltStore Ø£Ùˆ Sideloadly Ù„Ù„ØªØ«Ø¨ÙŠØª
          3. ÙØ¹Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
          
          ---
          
          **ØªØ·ÙˆÙŠØ±:** SR3H Team  
          **Ø§Ù„Ù…ÙˆÙ‚Ø¹:** www.SR3H.com  
          **Ø§Ù„Ø¯Ø¹Ù…:** support@sr3h.com
        files: SR3H_Video_Converter_v2.0.9.ipa
        draft: false
        prerelease: false
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}